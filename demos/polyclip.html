<head><meta name="viewport" content="user-scalable=no,initial-scale=1,maximum-scale=1">
<meta charset=utf-8>
<style>
body { margin: 0px; }
canvas { width:100%; height:100%; overflow: hidden; }
</style>
<script type="text/javascript" src="../h3du_min.js"></script>
<script type="text/javascript" src="../extras/frame.js"></script>
<script type="text/javascript" src="../extras/path.js"></script>
<script type="text/javascript" src="../extras/pathclip.js"></script>
<script type="text/javascript" src="../extras/pathshapes.js"></script>
<script type="text/javascript" src="demoutil.js"></script>
<script type="text/javascript" src="pathutil.js"></script>
</head>
<body>
<canvas id=canvas></canvas>
<script id="demo">
/* global H3DU, getPoints, pathFloor */
// <!--
/*
 Any copyright to this file is released to the Public Domain.
 http://creativecommons.org/publicdomain/zero/1.0/
 If you like this, you should donate
 to Peter O. (original author of
 the Public Domain HTML 3D Library) at:
 http://peteroupc.github.io/
*/

var path = new H3DU.GraphicsPath().ellipse(15, 15, 15, 15);
var path2 = new H3DU.GraphicsPath().ellipse(30, 15, 15, 15);
path = path.union(path2, 0.2);
var curves = path.getCurves(0.2);

function pointMarch(
  group, // shape group containing the marching points
  curves, // curves of the path
  t // value from 0 to 1 specifying the point in time of the animation
) {
  "use strict";
  var POINTCOUNT = 50;
  var adjust = t * (1.0 / (POINTCOUNT - 1));
  var pts = getPoints(curves, POINTCOUNT, adjust);
  for(var i = 0; i < pts.length; i++) {
    if(!group.shapes[i])continue;
    group.shapes[i].setVisible(true).setPosition(pts[i][0], pts[i][1], 0);
  }
  for(var j = pts.length; j < POINTCOUNT; j++) {
    if(!group.shapes[j])continue;
    group.shapes[j].setVisible(false);
  }
}
var scene = new H3DU.Scene3D(document.getElementById("canvas"));
scene.setClearColor("white");
var sub = new H3DU.Batch3D()
   .perspectiveAspect(45, 1, 1000)
   .setLookAt([22.5, 22.5 - 3 * 8, 1.2 * 50], [22.5, 22.5, 0], [0, 0, 1]);
var fc = new H3DU.FrameCounterDiv();
var group = new H3DU.ShapeGroup();
sub.getLights()
    .setDirectionalLight(0, [0, -3, 1.2], [1, 1, 1])
    .setDirectionalLight(1, [0, 3, 1.2], [0.6, 0.6, 0.6]);

var sphere = new H3DU.Shape(H3DU.Meshes.createSphere(0.2, 16, 8)).setColor("blue");
for(var i = 0; i < 50; i++) {
  group.addShape(sphere.copy());
}
sub.addShape(
    new H3DU.Shape(pathFloor(path)).setColor("#eeeeee"));
sub.addShape(group);

var timer = {};
H3DU.renderLoop(function(time) {
  "use strict";
  var t = H3DU.getTimePosition(timer, time, 1000);
  pointMarch(group, curves, t);
  fc.update();
  scene.render(sub);
});
// -->
</script>
</body>
